<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Parcel Panic</title>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
      <div class="loading-content">
        <h2>Parcel Panic</h2>
        <div class="loading-bar-container">
          <div class="loading-bar">
            <div class="loading-fill" id="loading-fill"></div>
          </div>
          <div class="loading-text" id="loading-text">Initializing...</div>
        </div>
        <div class="loading-percentage" id="loading-percentage">0%</div>
      </div>
    </div>

    <!-- Main Lobby Screen -->
    <div class="lobby-screen" id="lobby-screen" style="display: none;">
      <div class="lobby-container">
        <div class="lobby-header">
          <h1 class="lobby-title">🚛 Parcel Panic</h1>
          <p class="lobby-subtitle">Deliver packages before time runs out!</p>
        </div>
        
        <div class="lobby-buttons">
          <button class="lobby-btn primary" id="start-game-btn">
            <span class="btn-icon">🎮</span>
            <span class="btn-text">Start Game</span>
          </button>
          
          <button class="lobby-btn secondary" id="settings-btn">
            <span class="btn-icon">⚙️</span>
            <span class="btn-text">Settings</span>
          </button>
        </div>
        
        <div class="lobby-footer">
          <p class="lobby-tip">💡 Draw routes for your truck to deliver packages before time runs out!</p>
        </div>
      </div>
    </div>

    <!-- Lobby Settings Panel -->
    <div class="lobby-settings-panel" id="lobby-settings-panel" style="display: none;">
      <div class="lobby-settings-overlay">
        <div class="lobby-settings-content">
          <div class="lobby-settings-header">
            <h2>⚙️ Settings</h2>
            <button class="close-lobby-settings-btn" id="close-lobby-settings-btn" data-action="close-lobby-settings" aria-label="Close settings">
              <span>✕</span>
            </button>
          </div>
          
          <div class="lobby-settings-body">
            <div class="lobby-settings-section">
              <h3>🔊 Audio Settings</h3>
              
              <div class="lobby-setting-item">
                <label for="lobby-master-volume">
                  <span class="lobby-setting-label">Master Volume</span>
                  <span class="lobby-setting-value" data-ui="lobby-master-volume-value">100%</span>
                </label>
                <input type="range" id="lobby-master-volume" min="0" max="1" step="0.01" value="1" data-setting="lobbyMasterVolume" />
              </div>
              
              <div class="lobby-setting-item">
                <label for="lobby-sfx-volume">
                  <span class="lobby-setting-label">SFX Volume</span>
                  <span class="lobby-setting-value" data-ui="lobby-sfx-volume-value">100%</span>
                </label>
                <input type="range" id="lobby-sfx-volume" min="0" max="1" step="0.01" value="1" data-setting="lobbySfxVolume" />
              </div>
              
              <div class="lobby-setting-item">
                <label for="lobby-bg-volume">
                  <span class="lobby-setting-label">Background Music</span>
                  <span class="lobby-setting-value" data-ui="lobby-bg-volume-value">30%</span>
                </label>
                <input type="range" id="lobby-bg-volume" min="0" max="1" step="0.01" value="0.3" data-setting="lobbyBgVolume" />
              </div>
            </div>
            
            <div class="lobby-settings-section">
              <h3>🎮 Display Settings</h3>
              
              <div class="lobby-setting-item">
                <label for="lobby-fps-toggle">
                  <span class="lobby-setting-label">Target FPS</span>
                  <span class="lobby-setting-value" data-ui="lobby-fps-value">60 FPS</span>
                </label>
                <select id="lobby-fps-toggle" data-setting="lobbyTargetFPS">
                  <option value="30">30 FPS</option>
                  <option value="60" selected>60 FPS</option>
                  <option value="120">120 FPS</option>
                </select>
              </div>
            </div>
            
            <div class="lobby-settings-actions">
              <button class="lobby-settings-btn secondary" data-action="reset-lobby-settings">
                <span>🔄</span>
                <span>Reset to Default</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tutorial Prompt -->
    <div class="tutorial-prompt-overlay" id="tutorial-prompt-overlay" style="display: none;">
      <div class="tutorial-prompt">
        <div class="tutorial-prompt-header">
          <h2>📚 Welcome to Parcel Panic!</h2>
        </div>
        
        <div class="tutorial-prompt-content">
          <p>Would you like to see a quick tutorial to learn the basics?</p>
          <div class="tutorial-prompt-buttons">
            <button class="tutorial-prompt-btn primary" id="watch-tutorial-btn">
              <span>📖</span>
              <span>Watch Tutorial</span>
            </button>
            <button class="tutorial-prompt-btn secondary" id="skip-tutorial-btn">
              <span>▶️</span>
              <span>Skip & Play</span>
            </button>
          </div>
        </div>
      </div>
      </div>

    <!-- Tutorial Flashcards -->
    <div class="tutorial-flashcards-overlay" id="tutorial-flashcards-overlay" style="display: none;">
      <div class="tutorial-flashcards">
        <div class="tutorial-flashcards-header">
          <div class="tutorial-progress">
            <span class="tutorial-progress-text" id="tutorial-progress-text">1 / 7</span>
            <div class="tutorial-progress-bar">
              <div class="tutorial-progress-fill" id="tutorial-progress-fill"></div>
            </div>
          </div>
          <button class="close-tutorial-flashcards-btn" id="close-tutorial-flashcards-btn">✕</button>
        </div>
        
        <div class="tutorial-flashcard" id="tutorial-flashcard">
          <div class="flashcard-content">
            <div class="flashcard-title" id="flashcard-title">🎯 Objective</div>
            <div class="flashcard-body" id="flashcard-body">
              <p>Draw delivery routes for your truck to deliver packages to houses before their timers expire!</p>
            </div>
          </div>
        </div>
        
        <div class="tutorial-flashcards-footer">
          <button class="tutorial-flashcard-btn secondary" id="prev-flashcard-btn" style="display: none;">← Previous</button>
          <button class="tutorial-flashcard-btn primary" id="next-flashcard-btn">Next →</button>
        </div>
      </div>
    </div>

    <canvas id="stage" title="Playfield &mdash; draw loops here for the truck to follow."></canvas>

    <!-- Left Column: Detailed Stats -->
    <div class="ui-panel stats-column">
      <div class="stats-header">
        <h3>Game Stats</h3>
      </div>
      <div class="stats-grid">
        <div class="stat-item">
          <span class="stat-label">Week</span>
          <span class="stat-value" data-ui="week">1</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Time</span>
          <span class="stat-value" data-ui="week-timer">35</span>
          <span class="stat-detail" data-ui="time-detail">(base + upgrades)</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Route Status</span>
          <span class="stat-value route-cooldown" data-ui="route-cooldown">Ready</span>
          <span class="stat-detail" data-ui="route-detail">(base - upgrades)</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Seed</span>
          <span class="stat-value" data-ui="seed">-</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">GPU</span>
          <span class="stat-value" data-ui="webgpu-status">Checking...</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Speed</span>
          <span class="stat-value" data-ui="truck-speed">1.00</span>
          <span class="stat-detail" data-ui="speed-detail">(base + tuned engine)</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Service Radius</span>
          <span class="stat-value" data-ui="delivery-radius">2.0</span>
          <span class="stat-detail" data-ui="radius-detail">(base + upgrades)</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Speed Boost</span>
          <span class="stat-value" data-ui="speed-boost">None</span>
          <span class="stat-detail" data-ui="boost-detail">(temp upgrades)</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Speed Multiplier</span>
          <span class="stat-value" data-ui="speed-multiplier">1×</span>
          <span class="stat-detail" data-ui="mult-detail">(global)</span>
        </div>
      </div>
      <button class="settings-btn" data-action="settings" aria-label="Settings">
        <span>⚙️</span>
        <span>Settings</span>
      </button>
    </div>



    <!-- Top-Right: Control Panel -->
    <div class="ui-panel control-panel" aria-label="Playback controls">
        <button class="control-btn" data-action="pause" aria-pressed="false" title="Pause or resume (Space)">
          <span data-ui="pause-icon">&#9208;</span>
        </button>
        <button class="control-btn" data-action="speed" aria-pressed="false" title="Toggle 2&times; speed">
          <span data-ui="speed-label">1&times;</span>
        </button>
        <button class="control-btn social-btn" data-action="twitter" title="Follow on Twitter">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
          </svg>
        </button>
        <button class="control-btn social-btn" data-action="itch" title="Play on itch.io">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm-1-17v8.586l-3.293-3.293-1.414 1.414L12 16.414l5.707-5.707-1.414-1.414L13 13.586V5h-2z"/>
          </svg>
        </button>
      </div>

    <!-- Right Column: Game Elements -->
    <div class="ui-panel game-elements">
      <div class="elements-header">
        <h3>Game Elements</h3>
      </div>
      <div class="elements-grid">
        <div class="element-item">
          <div class="element-icon">🚛</div>
          <div class="element-text">
            <strong>Brown Truck</strong>
            Your delivery vehicle
          </div>
        </div>
        <div class="element-item">
          <div class="element-icon">🏠</div>
          <div class="element-text">
            <strong>Houses</strong>
            <div class="house-timers">
              <div class="timer-item">
                <div class="timer-color" style="background: #ef4444;"></div>
                <span class="color-red">Red</span> = Urgent (40s)
              </div>
              <div class="timer-item">
                <div class="timer-color" style="background: #a855f7;"></div>
                <span class="color-purple">Purple</span> = Medium (50s)
              </div>
              <div class="timer-item">
                <div class="timer-color" style="background: #22c55e;"></div>
                <span class="color-green">Green</span> = Normal (60s)
              </div>
            </div>
          </div>
        </div>
        <div class="element-item">
          <div class="element-icon">🔵</div>
          <div class="element-text">
            <strong>Blue Lines</strong>
            Active delivery routes
          </div>
        </div>
        <div class="element-item">
          <div class="element-icon">⏰</div>
          <div class="element-text">
            <strong>Timer Rings</strong>
            Shrink as time runs out
          </div>
        </div>
      </div>
    </div>

    <div class="debug hidden" data-ui="debug" title="Debug FPS counter">FPS&nbsp;<span data-ui="fps">60</span></div>

    <!-- ESC Menu -->
    <div class="esc-menu" id="esc-menu" style="display: none;">
      <div class="esc-menu-overlay">
        <div class="esc-menu-content">
          <div class="esc-menu-header">
            <h2>🎮 Game Menu</h2>
            <button class="close-esc-menu-btn" data-action="close-esc-menu" aria-label="Close menu">
              <span>✕</span>
            </button>
          </div>
          <div class="esc-menu-actions">
            <button class="esc-menu-btn primary" data-action="esc-settings">
              <span class="btn-icon">⚙️</span>
              <span class="btn-text">Settings</span>
            </button>
            <button class="esc-menu-btn secondary" data-action="return-to-lobby">
              <span class="btn-icon">🏠</span>
              <span class="btn-text">Return to Lobby</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="settings-panel" aria-label="Audio and settings" style="display: none;">
      <div class="settings-header">
        <h2>⚙️ Settings</h2>
        <button class="close-settings-btn" data-action="close-settings" aria-label="Close settings">
          <span>✕</span>
        </button>
      </div>
      
      <div class="settings-content">
        <div class="settings-section">
          <h3>🔊 Audio Settings</h3>
          
          <div class="setting-item">
            <label for="master-volume">
              <span class="setting-label">Master Volume</span>
              <span class="setting-value" data-ui="master-volume-value">100%</span>
            </label>
            <input type="range" id="master-volume" min="0" max="1" step="0.01" value="1" data-setting="masterVolume" />
          </div>
          
          <div class="setting-item">
            <label for="sfx-volume">
              <span class="setting-label">SFX Volume</span>
              <span class="setting-value" data-ui="sfx-volume-value">100%</span>
            </label>
            <input type="range" id="sfx-volume" min="0" max="1" step="0.01" value="1" data-setting="sfxVolume" />
          </div>
          
          <div class="setting-item">
            <label for="bg-volume">
              <span class="setting-label">Background Music</span>
              <span class="setting-value" data-ui="bg-volume-value">30%</span>
      </label>
            <input type="range" id="bg-volume" min="0" max="1" step="0.01" value="0.3" data-setting="bgVolume" />
          </div>
        </div>
        
        <div class="settings-section">
          <h3>🎮 Display Settings</h3>
          
          <div class="setting-item">
            <label for="fps-toggle">
              <span class="setting-label">Target FPS</span>
              <span class="setting-value" data-ui="fps-value">60 FPS</span>
      </label>
            <select id="fps-toggle" data-setting="targetFPS">
              <option value="30">30 FPS</option>
              <option value="60" selected>60 FPS</option>
              <option value="120">120 FPS</option>
            </select>
          </div>
        </div>
        
        <div class="settings-actions">
          <button class="settings-btn secondary" data-action="reset-settings">
            <span>🔄</span>
            <span>Reset to Default</span>
          </button>
        </div>
      </div>
    </div>

    <div class="modal upgrade-modal" aria-label="Weekly upgrade chooser">
      <div class="modal-panel">
        <h2>Weekly Upgrade</h2>
        <p>Select one card (1/2/3 keys).</p>
        <div class="upgrade-cards"></div>
      </div>
    </div>

    <div class="modal gameover-modal" aria-label="Game over summary">
      <div class="modal-panel">
        <h2>Route Failed</h2>
        <p>Final Score: <strong data-ui="final-score">0</strong></p>
        <p>Best Score: <strong data-ui="final-best">0</strong></p>
        <p>Seed: <code data-ui="final-seed">-</code></p>
        <div class="modal-actions">
          <button class="btn" data-action="retry">Retry Seed</button>
          <button class="btn" data-action="new-seed">New Run</button>
        </div>
      </div>
    </div>
    <script type="module" src="./src/main.js"></script>
  </body>
</html>


